{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\controller\\user.js"
    ],
    "names": [],
    "mappings": "AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;AACA;;;;;;;;;;;;;;;;;;;qBAOI,W,0BAAc;AACV,YAAI,OAAO,KAAK,KAAL,CAAW,UAAX,EAAuB,MAAvB,EAAX;;AAEA,aAAK,MAAL,CAAY,MAAZ,EAAoB,IAApB;;AAEA,eAAO,KAAK,OAAL,CAAa,OAAb,CAAP;AACH,K;;qBAED,S,wBAAY;AACR,YAAM,OAAO,KAAK,GAAL,EAAb;AACA,aAAK,KAAL,CAAW,UAAX,EAAuB,KAAvB,CAA6B,IAA7B,EAAmC,MAAnC;;AAEA,aAAK,QAAL,CAAc,aAAd;AACH,K;;;;;;;;;qBAOK,wB;;gBACI,O,EACA,I,EACA,M,EAEF,iB,EAEK,C,EACD,M,EAOA,G,EAEA,U;;;;;;AAhBF,mC,GAAU,KAAK,GAAL,E;;mCACG,KAAK,KAAL,CAAW,UAAX,EAAuB,MAAvB,E;;;AAAb,gC;;mCACe,KAAK,KAAL,CAAW,QAAX,EAAqB,IAArB,E;;;AAAf,kC;AAEF,6C,GAAoB,E;qEAEV,I;;;;;;;;AAAL,6B;AACD,kC,GAAS;AACT,qCAAK,OAAO,MADH;AAET,0CAAU,KAAK,CAAL,EAAQ,MAFT;AAGT,0CAAU,KAAK,CAAL,EAAQ;;AAHT,6B;AAOT,+B,GAAM,YAAY,QAAQ,EAApB,GAAyB,eAAzB,GAA2C,KAAK,WAAL,CAAiB,MAAjB,C;;mCAE9B,KAAK,UAAL,CAAgB,GAAhB,C;;;AAAnB,sC;;;AAEJ,gCAAI,WAAW,UAAX,IAAyB,GAA7B,EAAkC;AAC9B,kDAAkB,IAAlB,CAAuB;AACnB,4CAAQ,KAAK,CAAL,EAAQ,MADG;AAEnB,yCAAK,OAAO,MAFO;AAGnB,wCAAI,QAAQ,EAHO;AAInB,4CAAQ;AAJW,iCAAvB;AAOH,6BARD,MAQO;AACH,kDAAkB,IAAlB,CAAuB;AACnB,4CAAQ,KAAK,CAAL,EAAQ,MADG;AAEnB,yCAAK,OAAO,MAFO;AAGnB,wCAAI,QAAQ,EAHO;AAInB,4CAAQ;AAJW,iCAAvB;AAMH;;;;;;AAGL,iCAAK,KAAL,CAAW,QAAX,EAAqB,KAArB,CAA2B,EAAC,IAAG,QAAQ,EAAZ,EAA3B,EAA4C,MAA5C,CAAmD,EAAC,cAAa,MAAM,QAAN,EAAd,EAAnD;;6DAEO,KAAK,OAAL,CAAa,iBAAb,EAAgC,KAAK,MAAL,CAAY,eAAZ,CAAhC,C;;;;;;;;;;;;;;;;;qBAGX,W,wBAAY,G,EAAK;AACb,YAAI,MAAM,EAAV;;AAEA,aAAK,IAAI,CAAT,IAAc,GAAd,EAAmB;AACf,gBAAI,IAAJ,CAAS,IAAI,GAAJ,GAAU,mBAAmB,IAAI,CAAJ,CAAnB,CAAnB;AACH;;AAED,eAAO,IAAI,IAAJ,CAAS,GAAT,CAAP;AACH,K;;qBAED,U,uBAAW,G,EAAK;AACZ,YAAI,KAAK,MAAM,SAAN,CAAgB,kBAAQ,GAAxB,CAAT;AACA,eAAO,GAAG;AACN,iBAAK,GADC;AAEN,qBAAS;AACL,8BAAc;AADT;AAFH,SAAH,CAAP;AAMH,K",
    "file": "..\\..\\..\\src\\admin\\controller\\user.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\nimport request from 'request';\n\nexport default class extends Base {\n    /**\n     * index action\n     * @return {Promise} []\n     */\n    indexAction() {\n        let user = this.model('appusers').select();\n\n        this.assign('user', user);\n\n        return this.display('index');\n    }\n\n    delAction() {\n        const _get = this.get();\n        this.model('appusers').where(_get).delete();\n\n        this.redirect('/admin/user');\n    }\n\n    /*\n     * 单台客户端服务器用户同步\n     * @param ip\n     * @return json\n     */\n    async syncallremoteusersAction() {\n        const _server = this.get();\n        const user = await this.model('appusers').select();\n        const config = await this.model('config').find();\n\n        let resultRemoteUsers = [];\n\n        for (var i in user) {\n            let params = {\n                key: config.apiKey,\n                username: user[i].UserId,\n                password: user[i].RemotePassword\n\n            };\n\n            let url = 'http://' + _server.ip + '/setuser.asp?' + this.setUrlParam(params);\n\n            let resultData = await this.getApiData(url);\n\n            if (resultData.statusCode == 200) {\n                resultRemoteUsers.push({\n                    userId: user[i].UserId,\n                    key: config.apiKey,\n                    ip: _server.ip,\n                    status: true\n                });\n\n            } else {\n                resultRemoteUsers.push({\n                    userId: user[i].UserId,\n                    key: config.apiKey,\n                    ip: _server.ip,\n                    status: false\n                });\n            }\n        }\n\n        this.model('server').where({ip:_server.ip}).update({syncUserDate:think.datetime()});\n\n        return this.success(resultRemoteUsers, this.locale('query_success'));\n    }\n\n    setUrlParam(obj) {\n        let str = [];\n\n        for (var i in obj) {\n            str.push(i + '=' + encodeURIComponent(obj[i]));\n        }\n\n        return str.join('&');\n    }\n\n    getApiData(url) {\n        let fn = think.promisify(request.get);\n        return fn({\n            url: url,\n            headers: {\n                \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) Chrome/47.0.2526.111 Safari/537.36\"\n            }\n        });\n    }\n\n}"
    ]
}